<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atlas Haroldo Horta | 50 A√±os de Memoria Viva</title>
    
    <!-- Open Graph para Facebook/WhatsApp -->
    <meta property="og:title" content="Atlas Haroldo Horta | 50 A√±os de Memoria Viva">
    <meta property="og:description" content="28TB de memoria fotogr√°fica: desde Nicaragua Sandinista hasta la Patagonia">
    <meta property="og:image" content="https://haroldohorta.github.io/atlas/fotos/panos/01_portada.webp">
    <meta property="og:url" content="https://haroldohorta.github.io/atlas/">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Atlas Haroldo Horta">
    <meta name="twitter:description" content="50 a√±os de fotograf√≠a documental latinoamericana">
    <meta name="twitter:image" content="https://haroldohorta.github.io/atlas/fotos/panos/01_portada.webp">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />

    <style>
        /* --- ESTILO DARKROOM --- */
        body, html { margin: 0; padding: 0; height: 100%; background: #0f0f0f; font-family: 'Courier New', monospace; color: #ccc; }
        #map { height: 100%; width: 100%; background: #0f0f0f; }

        /* Estilos del Popup */
        .leaflet-popup-content-wrapper { background: #1a1a1a; color: #eee; border: 1px solid #ff9f1c; border-radius: 0; padding: 0; }
        .leaflet-popup-tip { background: #1a1a1a; border-top: 1px solid #ff9f1c; }
        .popup-img { width: 100%; height: 140px; object-fit: cover; border-bottom: 1px solid #ff9f1c; display: block; background: #000; }
        
        /* Bot√≥n del Popup */
        .btn-portafolio {
            width: 100%; background: #222; color: #ff9f1c; padding: 10px; cursor: pointer;
            text-transform: uppercase; font-weight: bold; font-size: 11px; text-decoration: none;
            display: block; text-align: center; box-sizing: border-box; transition: 0.3s;
        }
        .btn-portafolio:hover { background: #ff9f1c; color: #000; }

        /* --- PERSONALIZACI√ìN DE LAS BURBUJAS (CLUSTERS) --- */
        .marker-cluster-small, .marker-cluster-medium, .marker-cluster-large {
            background-color: rgba(255, 159, 28, 0.2) !important;
        }
        .marker-cluster div {
            background-color: #000 !important;
            color: #ff9f1c !important;
            border: 1px solid #ff9f1c;
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }
        
        /* Leyenda */
        .legend { 
            position: absolute; bottom: 30px; left: 30px; 
            background: rgba(0,0,0,0.8); border: 1px solid #444; 
            padding: 10px; z-index: 1000; font-size: 11px; 
            border-radius: 4px;
        }
        .dot { display: inline-block; width: 10px; height: 10px; border-radius: 50%; margin-right: 5px; }

        /* Loading Screen */
        #loading {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: #0f0f0f; z-index: 9999;
            display: flex; align-items: center; justify-content: center;
            flex-direction: column;
        }
        #loading .spinner {
            font-size: 50px; margin-bottom: 20px;
            animation: spin 2s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        #loading .text {
            color: #ff9f1c; font-size: 14px; text-transform: uppercase;
            letter-spacing: 2px;
        }
    </style>
</head>
<body>

<!-- Loading Screen -->
<div id="loading">
    <div class="spinner">üì∑</div>
    <div class="text">Cargando Atlas...</div>
</div>

<div id="map"></div>

<div class="legend">
    <div><span class="dot" style="background:#ff4d4d;"></span> CR√ìNICA</div>
    <div><span class="dot" style="background:#4d94ff;"></span> A√âREO</div>
    <div><span class="dot" style="background:#ffdb4d;"></span> N√ìMADA</div>
    <div style="margin-top:5px; color:#777;">* Haz clic en los n√∫meros para desplegar</div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>

<script>
    // 1. Mapa Base
    const map = L.map('map').setView([-22, -68], 4);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
        attribution: 'SUR DAO | Haroldo Horta', 
        maxZoom: 19
    }).addTo(map);

    // 2. Grupo de Clusters
    const markers = L.markerClusterGroup({
        spiderfyOnMaxZoom: true,
        showCoverageOnHover: false,
        zoomToBoundsOnClick: true,
        animate: true
    });

    const getStyle = (capa) => {
        if(!capa) return "#fff";
        if(capa.includes('Cr√≥nica')) return "#ff4d4d";
        if(capa.includes('A√©reo') || capa.includes('fly')) return "#4d94ff";
        if(capa.includes('N√≥mada')) return "#ffdb4d";
        return "#ffffff";
    };

    // 3. Cargar datos
    fetch('data/puntos_mapa.json')
        .then(res => res.json())
        .then(data => {
            console.log("Cargando puntos:", data.length);
            
            // Remover loading screen
            const loadingEl = document.getElementById('loading');
            if(loadingEl) loadingEl.remove();
            
            data.forEach(punto => {
                if (!punto.lat || !punto.lon) return;

                const color = getStyle(punto.capa);
                
                const marker = L.circleMarker([punto.lat, punto.lon], {
                    radius: 8,
                    fillColor: color,
                    color: "#000",
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 0.9
                });

                const zonaTitulo = punto.zona ? punto.zona.toUpperCase() : 'ZONA';
                marker.bindPopup(`
                    <div style="min-width: 180px; text-align: center;">
                        <div style="font-size:9px; color:#888; margin-bottom:5px; text-transform:uppercase;">
                            ${punto.capa || 'ARCHIVO'}
                        </div>
                        <h3 style="margin: 5px 0; color: #ff9f1c;">${zonaTitulo}</h3>
                        <img src="${punto.thumb}" class="popup-img" onerror="this.style.display='none'">
                        <div style="font-size:9px; color:#666; margin:8px 0;">${punto.id || ''}</div>
                        <a href="galeria.html?zona=${punto.zona}" class="btn-portafolio">ABRIR EXPEDIENTE üìÇ</a>
                    </div>
                `);

                markers.addLayer(marker);
            });

            map.addLayer(markers);
        })
        .catch(err => {
            console.error("Error cargando datos:", err);
            const loadingEl = document.getElementById('loading');
            if(loadingEl) {
                loadingEl.innerHTML = `
                    <div class="spinner">‚ö†Ô∏è</div>
                    <div class="text" style="color:#ff4d4d;">Error al cargar el Atlas</div>
                    <div style="color:#666; font-size:10px; margin-top:10px;">
                        Verifica que existe: data/puntos_mapa.json
                    </div>
                `;
            }
        });
</script>

</body>
</html>

